#!/bin/sh

# Slotmachine Trigger Button Listener rc.d handler
# @copyright Modehaus Pogoretschnik GmbH
# @author Bastian Kraus <bk@pogo-systems.de>

### BEGIN INIT INFO
# Provides:          Slotmachine Trigger
# Required-Start:    
# Required-Stop:     
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Slotmachine Trigger Watchdog fuer /dev/input/eventX
# Description:       
### END INIT INFO

### CONFIGURATION
### Modify this path to the directory where the trigger jar and the config file is in
basepath="/home/pi/slotmachine-java"

pidfile="$basepath/slotmachine-trigger.pid";
startcmd='java -jar $basepath/slotmachine-trigger-0.1-DEV.jar -c $basepath/config.properties &';

# set current working directory
cd "$basepath";

# Actions
case "$1" in
    start)
        # START
        echo "Starting slotmachine-trigger service...";
        if ! $(cat "$pidfile" 2>/dev/null) || ! $( kill -0 $(cat "$pidfile") 2>/dev/null ) ; then
                eval $startcmd;
                echo $! > "$pidfile";
                echo "Slotmachine trigger service started with pid: $(cat "$pidfile")";
            else
                echo "Slotmachine trigger service already running with PID: $(cat "$pidfile")";
        fi
        ;;
    stop)
        # STOP
        echo "Stopping Slotmachine Trigger Service with pid: $(cat "$pidfile")...";
        pid=$(cat "$pidfile")
        if  $(kill -0 $(cat "$pidfile") 2>/dev/null ) ; then
                kill -15 $pid;
                rm -f $pidfile;
                echo "... stopped!";
        else
                echo "... no process with pid $pid found!";
        fi
        ;;
    restart)
        # RESTART
        $0 stop;
        $0 start;
        ;;
	*)
        echo "Usage: /etc/init.d/slotmachine {start|stop|restart}"
        exit 1
        ;;
esac

exit 0